<Window
    x:Class="PasswordVaultUSB.Views.RegisterView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:vm="clr-namespace:PasswordVaultUSB.ViewModels"
    Title="Registration"
    Width="800"
    Height="650"
    Style="{StaticResource WindowStyle}"
    WindowStartupLocation="CenterScreen">

    <Window.DataContext>
        <vm:RegisterViewModel />
    </Window.DataContext>

    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVis" />
    </Window.Resources>

    <Window.InputBindings>
        <KeyBinding
            Key="Enter"
            Command="{Binding RegisterCommand}"
            CommandParameter="{Binding RelativeSource={RelativeSource AncestorType=Window}}" />
    </Window.InputBindings>

    <Grid>
        <Border
            Width="400"
            Padding="30"
            HorizontalAlignment="Center"
            VerticalAlignment="Center"
            Background="{StaticResource CardBackgroundBrush}"
            CornerRadius="10">
            <Border.Effect>
                <DropShadowEffect
                    BlurRadius="20"
                    Opacity="0.4"
                    ShadowDepth="5"
                    Color="{StaticResource ShadowColor}" />
            </Border.Effect>

            <StackPanel>
                <StackPanel Margin="0,0,0,30">
                    <TextBlock
                        HorizontalAlignment="Center"
                        FontSize="26"
                        FontWeight="Bold"
                        Foreground="{StaticResource TextPrimaryBrush}"
                        Text="New user" />
                    <TextBlock
                        Margin="0,5,0,0"
                        HorizontalAlignment="Center"
                        FontSize="14"
                        Foreground="{StaticResource TextSecondaryBrush}"
                        Text="Create your own secure vault" />
                </StackPanel>

                <StackPanel Margin="0,0,0,15">
                    <TextBlock Style="{StaticResource LabelStyle}" Text="Username" />
                    <Border Style="{StaticResource InputBorderStyle}">
                        <TextBox
                            x:Name="RegUsernameInput"
                            Style="{StaticResource BaseInputStyle}"
                            Text="{Binding Username, UpdateSourceTrigger=PropertyChanged}" />
                    </Border>
                    <TextBlock
                        Style="{StaticResource ErrorTextStyle}"
                        Text="{Binding UsernameError}"
                        Visibility="{Binding IsUsernameErrorVisible, Converter={StaticResource BoolToVis}}" />
                </StackPanel>

                <StackPanel Margin="0,0,0,15">
                    <TextBlock Style="{StaticResource LabelStyle}" Text="Password" />
                    <Border Style="{StaticResource InputBorderStyle}">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="40" />
                            </Grid.ColumnDefinitions>
                            <PasswordBox
                                x:Name="RegPasswordInput"
                                Grid.Column="0"
                                PasswordChanged="RegPasswordInput_PasswordChanged"
                                Style="{StaticResource BasePasswordBoxStyle}" />
                            <TextBox
                                x:Name="RegPasswordVisible"
                                Grid.Column="0"
                                FontFamily="Consolas"
                                FontSize="18"
                                Style="{StaticResource BaseInputStyle}"
                                TextChanged="RegPasswordVisible_TextChanged"
                                Visibility="Collapsed" />
                            <Button
                                x:Name="ToggleRegPasswordButton"
                                Grid.Column="1"
                                Background="Transparent"
                                BorderThickness="0"
                                Click="ToggleRegPasswordButton_Click"
                                Cursor="Hand">
                                <Image
                                    x:Name="RegEyeIcon"
                                    Width="20"
                                    Height="20"
                                    Opacity="0.6"
                                    Source="/Resources/visibility.png" />
                            </Button>
                        </Grid>
                    </Border>
                    <TextBlock
                        Style="{StaticResource ErrorTextStyle}"
                        Text="{Binding PasswordError}"
                        Visibility="{Binding IsPasswordErrorVisible, Converter={StaticResource BoolToVis}}" />
                </StackPanel>

                <StackPanel Margin="0,0,0,25">
                    <TextBlock Style="{StaticResource LabelStyle}" Text="Repeat Password" />
                    <Border Style="{StaticResource InputBorderStyle}">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="40" />
                            </Grid.ColumnDefinitions>
                            <PasswordBox
                                x:Name="ConfPasswordInput"
                                Grid.Column="0"
                                PasswordChanged="ConfPasswordInput_PasswordChanged"
                                Style="{StaticResource BasePasswordBoxStyle}" />
                            <TextBox
                                x:Name="ConfPasswordVisible"
                                Grid.Column="0"
                                FontFamily="Consolas"
                                FontSize="18"
                                Style="{StaticResource BaseInputStyle}"
                                TextChanged="ConfPasswordVisible_TextChanged"
                                Visibility="Collapsed" />
                            <Button
                                x:Name="ToggleConfPasswordButton"
                                Grid.Column="1"
                                Background="Transparent"
                                BorderThickness="0"
                                Click="ToggleConfPasswordButton_Click"
                                Cursor="Hand">
                                <Image
                                    x:Name="ConfEyeIcon"
                                    Width="20"
                                    Height="20"
                                    Opacity="0.6"
                                    Source="/Resources/visibility.png" />
                            </Button>
                        </Grid>
                    </Border>
                    <TextBlock
                        Style="{StaticResource ErrorTextStyle}"
                        Text="{Binding ConfPasswordError}"
                        Visibility="{Binding IsConfPasswordErrorVisible, Converter={StaticResource BoolToVis}}" />
                </StackPanel>

                <Button
                    Height="45"
                    Command="{Binding RegisterCommand}"
                    CommandParameter="{Binding RelativeSource={RelativeSource AncestorType=Window}}"
                    Content="Create account"
                    Style="{StaticResource ModernButtonStyle}" />

                <Button
                    Margin="0,15,0,0"
                    Command="{Binding NavigateToLoginCommand}"
                    Content="Already have an account? Log in"
                    Style="{StaticResource LinkButtonStyle}" />
            </StackPanel>
        </Border>
    </Grid>
</Window>